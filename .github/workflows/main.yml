- name: Surgical Hard-Wire Patch (Corrected)
        run: |
          export LC_ALL=C
          export LANG=C
          
          # 1. DEFINE YOUR SECRETS
          # The Base URL for YouTube (Note the trailing slash!)
          YT_URL="rtmps://a.rtmps.youtube.com:443/live2/"
          # Your Specific Key
          YT_KEY="3w6v-1cgm-sjrj-8y4r-9v48"

          echo "--- STARTING PATCH ---"

          # 2. FIX THE CONNECTIONS (The Plumbing)
          # We replace the Twitch URL with the YouTube BASE only.
          # This prevents the "Double Key" error.
          find . -type f -name "*.swift" -exec sed -i '' "s|rtmp://live.twitch.tv/app/|$YT_URL|g" {} +
          
          # 3. HARD-WIRE THE KEY (The trickiest part)
          # We look for where the app stores the key and force yours in.
          # This replaces empty string defaults like 'var streamKey = ""' with your key.
          find . -type f -name "*.swift" -exec sed -i '' "s/var streamKey = \"\"/var streamKey = \"$YT_KEY\"/g" {} +
          find . -type f -name "*.swift" -exec sed -i '' "s/let defaultKey = \"\"/let defaultKey = \"$YT_KEY\"/g" {} +

          # 4. FIX THE UI (The Paint)
          # Change the label "Twitch" to "YouTube" so you know it worked.
          find . -type f -name "*.swift" -exec sed -i '' 's/"Twitch"/"YouTube Hard-Wired"/g' {} +

          # 5. PROTOCOL LOCKDOWN (Safe Mode)
          # Force SSL (RTMPS) and Port 443
          find . -type f -name "*.swift" -exec sed -i '' "s|rtmp://|rtmps://|g" {} +
          # This is the SAFE way to change the port (only changing lines that explicitly say 'port:')
          find . -type f -name "*.swift" -exec sed -i '' 's/port: 1935/port: 443/g' {} +

          # 6. STABILITY (Average Bitrate)
          find SourcePackages -type f -name "VTSessionOptionKey.swift" -exec sed -i '' 's/kVTCompressionPropertyKey_VariableBitRate/kVTCompressionPropertyKey_AverageBitRate/g' {} +
          
          echo "--- PATCH COMPLETE ---"
